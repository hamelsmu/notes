---
title: Data in fastai
---


<!--- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file.-->


```python
from fastbook import *
```

# Data In fastai

One of the most important things in fastai to understand is how you prepare your data for a model.  The main workhorse for accomplishing this in fastai is the `DataBlock` api.  Here is a hello world example of how this works:

## Hello World DataBlock

The argument `get_x` and `get_y` operate on an iterable.  Let's define an interable as our data:


```python
data = list(range(100))
```


```python
def get_x(r): return r
def get_y(r): return r + 10
dblock = DataBlock(get_x=get_x, get_y = get_y)
dsets = dblock.datasets(data)
```

You can see a dataset like so:


```python
dsets.train[0]
```

<CodeOutputBlock lang="python">




    (89, 99)



</CodeOutputBlock>

You can also see a DataLoader like so:


```python
dls = dblock.dataloaders(data, bs=5)
```


```python
next(iter(dls.train))
```

<CodeOutputBlock lang="python">




    (tensor([57, 66, 73, 30, 14]), tensor([67, 76, 83, 40, 24]))



</CodeOutputBlock>

### With A DataFrame

Similarly, you can operate on one row at a time:


```python
import pandas as pd
df = pd.DataFrame({'x': range(100), 'y': range(100) })
df.head()
```
    
<HTMLOutputBlock >




```html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
```



</HTMLOutputBlock>


```python
def get_x(r): return r.x
def get_y(r): return r.y + 10
dblock = DataBlock(get_x=get_x, get_y=get_y)
dsets = dblock.datasets(df)
```


```python
dsets.train[0]
```

<CodeOutputBlock lang="python">




    (78, 88)



</CodeOutputBlock>


```python
dls = dblock.dataloaders(df, bs=3)
next(iter(dls.train))
```

<CodeOutputBlock lang="python">




    (tensor([90, 55, 11]), tensor([100,  65,  21]))



</CodeOutputBlock>


```python
def tracer(nm):
    def f(x, nm):
        # print(f'{nm}:')
        # print(f'\tinput: {x}')
        # import ipdb; ipdb.set_trace()
        return str(x)
    return partial(f, nm=nm)
```


```python
def mult_0(x): return x * 0
def add_1(x): return x +1 
tb = TransformBlock(item_tfms=[tracer('item_tfms')])
# def get_y(l): return sum(l)
db = DataBlock(blocks=(TransformBlock, TransformBlock),
               get_x=mult_0,
               get_y=add_1,
               item_tfms=lambda x: str(x))
```


```python
data = L(range(10))
result = db.datasets(data)
```


```python
db.summary(data)
```

<CodeOutputBlock lang="python">

    Setting-up type transforms pipelines
    Collecting items from [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
    Found 10 items
    2 datasets of sizes 8,2
    Setting up Pipeline: mult_0
    Setting up Pipeline: add_1
    
    Building one sample
      Pipeline: mult_0
        starting from
          1
        applying mult_0 gives
          0
      Pipeline: add_1
        starting from
          1
        applying add_1 gives
          2
    
    Final sample: (0, 2)
    
    
    Collecting items from [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
    Found 10 items
    2 datasets of sizes 8,2
    Setting up Pipeline: mult_0
    Setting up Pipeline: add_1
    Setting up after_item: Pipeline: <lambda> -> ToTensor
    Setting up before_batch: Pipeline: 
    Setting up after_batch: Pipeline: 
    
    Building one batch
    Applying item_tfms to the first sample:
      Pipeline: <lambda> -> ToTensor
        starting from
          (0, 2)
        applying <lambda> gives
          (0, 2)
        applying ToTensor gives
          (0, 2)
    
    Adding the next 3 samples
    
    No before_batch transform to apply
    
    Collating items in a batch
    
    No batch_tfms to apply


</CodeOutputBlock>


```python
result.train[0]
```

<CodeOutputBlock lang="python">




    (0, 5)



</CodeOutputBlock>


```python
result = db.dataloaders(data, bs=3)
```


```python
thing = iter(result.train)
```


```python
next(thing)
```

<CodeOutputBlock lang="python">




    (('0', '0', '0'), ('6', '7', '4'))



</CodeOutputBlock>


```python
next(thing)
```

<CodeOutputBlock lang="python">




    (('0', '0', '0'), ('9', '5', '3'))



</CodeOutputBlock>


```python
??TransformBlock
```


```python
db = DataBlock(blocks=(TransformBlock, tb),
              get_y=lambda x: str(x),
              batch_tfms=tracer('batch_tfms'))
```


```python
result = db.datasets(data)
result = db.dataloaders(data, bs=3)
```


```python
result
```

<CodeOutputBlock lang="python">




    <fastai.data.core.DataLoaders at 0x7f9e08ff0160>



</CodeOutputBlock>


```python
thing = iter(result.train)
```


```python
next(thing)
```

<CodeOutputBlock lang="python">




    (('1', '5', '6'), ('1', '5', '6'))



</CodeOutputBlock>


```python
f = aug_transforms()[0]
```


```python
f
```

<CodeOutputBlock lang="python">




    Flip -- {'size': None, 'mode': 'bilinear', 'pad_mode': 'reflection', 'mode_mask': 'nearest', 'align_corners': True, 'p': 0.5}:
    encodes: (TensorImage,object) -> encodes
    (TensorMask,object) -> encodes
    (TensorBBox,object) -> encodes
    (TensorPoint,object) -> encodes
    decodes: 



</CodeOutputBlock>
